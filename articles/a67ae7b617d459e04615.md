---
title: "Nginx ã§ WebDAV ç’°å¢ƒæ§‹ç¯‰ã€PROPFIND 405 ãŒä½¿ãˆãªã‹ã£ãŸã®"
emoji: "ğŸ“"
type: "tech"
topics: nginx webdav
published: true
---

# WebDAV
æœ€è¿‘ã§ã¯çµæ§‹ãŠé¦´æŸ“ã¿ã®è¦æ ¼ã€ŒWebDAVã€ã§ã™ãŒMicroSoftãŒå…ˆå°ã—ã¦ä½œã£ãŸè¦æ ¼ã ã‘ã©ã€ãªãœã‹Windows8ã§ã¯ä½¿ãˆãªã„ï¼ˆæ­£ç¢ºã«ã¯ã¡ã‚‡ã£ã¨æ‰‹é–“ã‹ã‹ã‚‹ï¼‰ã¨ã‹ã€ãªã‚“ã‹æ”¾ç½®æ°—å‘³ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã™ãŒã€FTPã¨ã‹scpã¨ã‹ã‚ˆã‚Šæ•·å±…ãŒä½ã„ã®ã¨ã€æœ€è¿‘ã®ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã ã¨DLNAã¨ãªã‚‰ã‚“ã§å¯¾å¿œã—ã¦ãŸã‚Šã™ã‚‹ã®ã§å®¶ã§å‹•ç”»ã¿ã‚‹ã¨ãã«ä¾¿åˆ©ãªã“ã„ã¤ã€‚

ã§ã‚‚ã£ã¦ãã‚“ãªä¾¿åˆ©ãªç’°å¢ƒã¯ã™ã§ã«Apache ã§ç’°å¢ƒæ§‹ç¯‰æ¸ˆã¿ãªã‚ã‘ãªã‚“ã§ã™ãŒã€GWä¸­ã§æš‡ãªã®ã§Nginx ã§ WebDAV ç’°å¢ƒæ§‹ç¯‰ã‚’ã•ãã£ã¨ä½œã£ã¦ã¿ã‚ˆã†ã¨æ€ã£ã¦ã¿ã¾ã—ãŸã€‚ãã—ã¦ã¾ãŸãƒãƒãƒƒã‚¿ï½—ã€‚ã¤ãƒ¼è‡ªåˆ†å‚™å¿˜éŒ²ã§ã™ã€‚

# PROPFINDãŒ405
ã“ã¡ã®è¨˜äº‹ã€Œ[nginxã§WebDAV (nginx-dav-ext-moduleã¯ãªã—)](http://qiita.com/megmogmog1965/items/c23fb1b28f32c09e5501)ã€ã‚’è¦‹ã¦ã•ã£ãã‚Šyumã§ç’°å¢ƒã‚’ä½œã£ã¦ã¿ãŸã®ã§ã™ãŒã€WebDAVã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨PROPFINDãŒ405ãŒã§ã‚‹ã‚“ã§ã™ã‚ˆã€‚

```
192.168.11.1 - - [05/May/2015:08:40:23 +0900] "OPTIONS / HTTP/1.1" 405 166 "-" "Rei.Fs.WebDAV/1.11.12
```

ãªã‚“ã§ã ï¼Ÿã£ã¦æ€ã£ãŸã‚‰ã€‚ã€ŒPROPFIND, OPTIONSã€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è§£é‡ˆã§ããªã„ãŸã‚ã‚‰ã—ã„ã€‚dav_methods ã§ã¯ã€ŒPROPFIND, OPTIONSã€ãŒå®šç¾©ã§ããªã„ã€‚

> [WebDAVã§PROPFINDãŒ405](http://lunatear.net/archives/000520.html)

# ä»•æ–¹ãªã„ã®ã§ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
ã„ã¤ã‚‚ã®vagrantç’°å¢ƒã‚’ä½œæˆã—ãã“ã§å‹•ä½œãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚ã‚½ãƒ¼ã‚¹ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã®ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç’°å¢ƒã‚’ä½œæˆã™ã‚‹ãœã„ï¼ï¼

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç’°å¢ƒã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨nginx, nginx-dav-ext-moduleã‚½ãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```
$ sudo yum install expat-devel
$ sudo yum install wget gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel gd gd-devel
$ wget http://nginx.org/download/nginx-1.9.0.tar.gz
$ tar zxvf nginx-1.9.0.tar.gz 
$ cd nginx-1.9.0
$ git clone https://github.com/arut/nginx-dav-ext-module.git
```

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€yum ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨åŒç­‰ã¨ã—ã¾ã™ã€‚ã“ã“ã§æ³¨æ„ã™ã‚‹ç‚¹ã¯ã€```--add-module=./nginx-dav-ext-module``` ã‚’å«ã‚ã‚‹ã“ã¨ã€‚

```
$ cd nginx-1.9.0
# ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' --add-module=./nginx-dav-ext-module
$ make
$ sudo make install
```

nginx ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```
$ sudo useradd -s/sbin/nologin -d/usr/local/nginx -M nginx
```

/etc/init.d/ ã« nginx ã®èµ·å‹•ï¼çµ‚äº†ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
ä½™åˆ†ãªæ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ ```service nginx start``` ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰é©å®œå‰Šé™¤ã™ã‚‹ã€‚

```
# cd /etc/init.d
# wget -O nginx "http://wiki.nginx.org/index.php?title=RedHatNginxInitScript&action=raw&anchor=nginx"
# chmod +x nginx
```

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜è¿°ã™ã‚‹ãœã„
ãªã‚“ã ã‹ /etc/nginx/nginx.conf ã‚ã¾ã‚Šã„ã‘ã¦ãªã„ã®ã§ä¿®æ­£ã—ã¾ã™ã€‚

```text:/etc/nginx/nginx.conf
user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    server_tokens off;
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    keepalive_timeout  65;
    include /etc/nginx/conf.d/*.conf;
}
```

# WebDavã®å®šç¾©ã‚’è¨˜è¿°ã—ã¾ã™
ãã®å‰ã« ```/etc/nginx/conf.d```ã‚’ä½œæˆã—ã¨ãã¾ã™ã€‚

```text:/etc/nginx/conf.d/webdav.conf
server {
  listen       8888;
  server_name  localhost;

  location / {
  root /tmp;
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ‰
    charset utf-8;

    # ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç¢ºèªã™ã‚‹ã¨ã
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;

    # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®ä¸Šé™
    client_max_body_size   100m;

    # WebDAVè¨­å®š
    dav_methods  PUT DELETE MKCOL COPY MOVE;

    # nginx-dav-ext-module ã®æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰
    dav_ext_methods PROPFIND OPTIONS;

    # WebDAVã§ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’è¨­å®š
    dav_access group:r all:r;
    client_body_temp_path  /tmp;
    create_full_put_path on;

    access_log /var/log/nginx/webdav.access.log;
    error_log /var/log/nginx/webdav.error.log;
  }
}
```

# CarotDAV
Windowsã®WebDAVã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã€Œ[CarotDAV](http://rei.to/carotdav.html)ã€ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚

# æ¬¡å›ã¯
ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã ã£ãŸã‚‰è‰²ã€…ã¨åˆ¶é™è–„ãã¦ã„ã„ã ã‚ã†ã‘ã©ã€ã¨ã‚Šã‚ãˆãšDigest èªè¨¼ã¨SSLä½ã¯è¨­å®šã—ã¦ãŠãã€‚ã£ã¦ã“ã¨ã§ç’°å¢ƒã‚’ä½œã£ã¦ã¿ã‚‹ã€‚
ã•ã¦ã€ãŠæ˜¼ã”é£¯ã„ã“ã†ã£ã¨ï½ï½ã€‚




