---
title: "ã„ã¾ã•ã‚‰ CentOS8ã« ã€ŒInfluxDB 1.8.3 + Telegraf + Chronografã€"
emoji: "ðŸ“"
type: "tech"
topics: centos8 influxdb Telegraf Chronograf Raspberry
published: true
---

# Raspberry Pi 4Bã®æ¸©åº¦ã‚’ç®¡ç†ã—ãŸã„
çˆ†ç†±ã®Pi4ãŒè¤‡æ•°å°ã‚ã‚Šå¤ã®æš‘ã„æ™‚æœŸCPUæ¸©åº¦ãŒæ°—ã«ãªã£ã¦æ°—ã«ãªã£ã¦ä»•æ–¹ãªã `vcgencmd measure_temp` ã°ã‹ã‚Šå©ã„ã¦ãŸ2020ã€‚ã€ŒChronografã€ã¤ã‹ã†ã¨æ¥½ã ï½žã‚ˆã£ã¦ã“ã¨ã§æ•™ãˆã¦ã‚‚ã‚‰ã£ãŸã‘ã©æ‰‹é †ãŒãƒ¡ãƒ³ãƒ‰ã‚¯ã‚µã‚¤ã‚“ã§ã—ã‚‡ï¼Ÿã¨æ”¾ç½®ã—ã¦ã¾ã—ãŸï½—ï½—ã€‚

# ã„ã¾ã•ã‚‰ã€ŒInfluxDB + Telegraf + Chronografã€ãã‚ŒãŠã„ã—ã„ã®ï¼Ÿ
InfluxDB ã¯ [InfluxData](https://www.influxdata.com/get-influxdb/) ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã™ã€‚Telegraf + Chronograf ã‚‚ã“ã®ä¼šç¤¾ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã®ã§æ§‹ç¯‰ã¯å‰²ã¨ç°¡å˜ã«ã§ãã‚‹ã€‚

ã¡ãªã¿ã« [Telegraf](https://www.influxdata.com/time-series-platform/telegraf/) ã¯ã€InfluxDBå°‚ç”¨ã®ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚³ãƒ¬ã‚¯ã‚¿ã€‚
[Chronograf](https://www.influxdata.com/time-series-platform/chronograf/) ã¯ã€InfluxDBå°‚ç”¨ã®å¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚

ãŸã¶ã‚“ã ã‘ã©ã€(NET-SNMP+MRTG)ã§ã‚„ã‚‹ã‚ˆã‚Šç°¡å˜ã€‚ã“ã‚ŒãŠã™ã™ã‚ã€‚

# æ§‹æˆ
ã“ã‚“ãªæ„Ÿã˜ã®æ§‹æˆã«ã—ã¦ã¿ã‚‹ã€‚
CentOS8 : InfluxDB , Chronograf
Pi4B : Telegraf 
InfluxDB : influxdb-1.8.3.x86_64.rpm
Chronograf : chronograf-1.8.5.x86_64.rpm
Telegraf : telegraf-1.15.3-1.x86_64.rpm / telegraf-1.15.3

å›³ã«ã™ã‚‹ã¨ä¸‹è¨˜ã¿ãŸã„ãªã‹ã‚“ã˜

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44540/0f2c9d11-0ea4-78fd-889d-d56fdd8c1a39.png)


# CentOSã« InfluxDB, Chronograf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
InfluxDB ã¯ã€Piã ã¨éžåŠ›ã‹ã‚‚ï¼Ÿã¨ã‹è¨˜äº‹ã¿ãŸã®ã§ InfluxDB, Chronograf ã¯ã€ã¡ã‚‡ã„ã¨ãƒ‘ãƒ¯ãƒ¼ã®ã‚ã‚‹å´ã«ã‚¤ãƒ³ã‚¹ã‚³ã—ã¦ã¿ã‚‹ã€‚

## InfluxDB ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rpmã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚ã§ãã‚‹ãŒã€yumã‚³ãƒžãƒ³ãƒ‰ã®æ–¹ãŒæ¥½ãªã®ã§ã€ä¸‹è¨˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```/etc/yum.repos.d/influxdb.repo
[influxdb]
name = InfluxDB Repository
baseurl = https://repos.influxdata.com/rhel/8/x86_64/stable/
enabled = 1
gpgcheck = 1
gpgkey = https://repos.influxdata.com/influxdb.key
```

yum ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ã“ã‚Œã ã‘ã€‚

```cmd
$ sudo dnf makecache
$ sudo yum install influxdb
$ systemctl enable --now influxdb.service
```

influx ã‚³ãƒžãƒ³ãƒ‰ã‚’ã¤ã‹ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨ã‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸ InfluxDB ã¯ã€8086 ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‚‹ã®firewallã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

> [æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ InfluxDBã¨ã¯ï¼Ÿ](https://www.mikan-tech.net/entry/what-is-influxdb)

## Chronograf ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã“ã£ã¡ã¯rpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã„ã‚Œã¦ã¿ã‚‹ã€‚
Chronograf ã¯ã€8888 ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‚‹ã®firewallã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

```cmd
$ wget https://repos.influxdata.com/rhel/8/x86_64/stable/chronograf-1.8.5.x86_64.rpm
$ sudo yum localinstall chronograf-1.8.5.x86_64.rpm
$ sudo systemctl enable --now chronograf
$ sudo systemctl status chronograf
```

ã¨ã‚Šã‚ãˆãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã„ã¦ã‚ã¨ã‹ã‚‰è¨­å®šã™ã‚‹ã€‚

# CentOS/Pi4ã« Telegraf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
ç›£è¦–ã—ãŸã„OSã«ã€Telegraf ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚CentOS/Pi4 ã¨è‹¥å¹²ã‚¤ãƒ³ã‚¹ã‚³ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãŒé•ã†ã®ã§ãƒ¡ãƒ¢ã€‚


## CentOSã« Telegraf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã™ã‚‹

```cmd
$ wget https://repos.influxdata.com/rhel/8/x86_64/stable/telegraf-1.15.3-1.x86_64.rpm
$ sudo yum localinstall telegraf-1.15.3-1.x86_64.rpm
$ sudo systemctl enable --now telegraf
$ sudo systemctl status telegraf
```

## Pi4ã« Telegraf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```cmd
$ sudo curl https://repos.influxdata.com/influxdb.key | apt-key add -
$ sudo vi /etc/apt/sources.list.d/influxdb.list

deb https://repos.influxdata.com/debian buster stable

$ sudo apt update
$ sudo apt install telegraf
$ sudo systemctl enable --now telegraf
$ systemctl status telegraf.service
```

## telegraf.conf ã‚’ä¿®æ­£ã™ã‚‹
telegraf.conf ã«å¯¾ã—ã¦æœ€ä½Žé™ã®è¨­å®šã‚’ã™ã‚‹ã€‚é›£ã—ã„ã“ã¨ã¯ãªã„ã¨æ€ã†ã€‚

```/etc/telegraf/telegraf.conf
[agent]
  urls = ["http://192.xxx.yyy.zzz:8086"]  # InfluxDBã‚¤ãƒ³ã‚¹ãƒˆã—ãŸIP
  database = "telegraf"
  retention_policy = ""
  write_consistency = "any"
  timeout = "5s"
```

ãã®ã‚ã¨ã€‚å†èµ·å‹•ï¼ˆé¢å€’ãªã‚‰ï¼‰ã™ã‚‹ã€‚

# Chronograf ã‚’èµ·å‹•ã—ã¦ã¿ã‚‹
Chronograf ã‚’èµ·å‹•ã—ã¦ã¿ã‚‹ã€‚ 8888 ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã­ã€‚
æ—¥æœ¬èªžã«å¯¾å¿œã—ã¦ã„ãªã„ã§æ‹’å¦æ„Ÿã‚ã‚‹ã‘ã©ã“ã“ã¯ã€é ‘å¼µã‚ã†ã€‚

> [ã‚„ãŸã‚‰åˆ†ã‹ã‚Šã‚„ã™ã„åˆã‚ã¦ã®Chronograf](https://www.ultra-noob.com/blog/2020-04-02-%E3%82%84%E3%81%9F%E3%82%89%E5%88%86%E3%81%8B%E3%82%8A%E3%82%84%E3%81%99%E3%81%84%E5%88%9D%E3%82%81%E3%81%A6%E3%81%AEchronograf/)

Telegraf ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå‹•ã„ã¦ã„ã‚Œã°ã€ä¸‹è¨˜ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨æ€ã†ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44540/35ab1b61-91c5-e033-ffa6-f613cda89062.png)


## Raspberry pi4 ã®æ¸©åº¦ç®¡ç†
Raspberry pi ã«ã¯æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼ãŒã¤ã„ã¦ã„ã‚‹ã®ã§ã€CPUæ¸©åº¦ã‚’ Telegraf ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµŒç”±ã§ InfluxDB ã«ç™»éŒ²ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚
æ•·å±…ãŒé«˜ã„ã‹ã¨æ€ã„ãã‚„å‰²ã¨ç°¡å˜ã ã£ãŸã®ã§è‰²ã€…ã¨å¿œç”¨ã§ãã‚‹ã¯ãšã€‚

> ãƒ»[ã€Raspberry Pi + InfluxDB + Telegrafã€‘ãƒ©ã‚ºãƒ‘ã‚¤ã®CPUæ¸©åº¦ã‚’è¨˜éŒ²ã™ã‚‹æ–¹æ³•](https://www.ultra-noob.com/blog/2020-08-29-%E3%80%90Raspberry%20Pi%20_%20InfluxDB%20_%20Telegraf%E3%80%91%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A4%E3%81%AECPU%E6%B8%A9%E5%BA%A6%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95/)
> ãƒ»[How to measure a Raspberry Pi's temperature and CPU frequency with Telegraf](https://stanislas.blog/2018/12/how-to-measure-raspberry-pi-temperature-cpu-frequency-telegraf/)


ã‚¿ãƒ³ã‚³ãƒ”ã§ã™ãŒã€ã“ã†ã„ã†ã®ã¯ä½“æ„ŸãŒå¿…è¦ã€‚`/usr/local/bin/rpi-temp`
 ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚

```/usr/local/bin/rpi-temp
#!/bin/bash

awk '{print $1/1000}' /sys/class/thermal/thermal_zone0/temp
```

æ¬¡ã€å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ã€‚å©ã„ã¦ã¿ã‚‹ã€‚å€¤ãŒã§ã‚‹ã€‚ã“ã‚ŒãŒå¿…è¦ã€‚

```/usr/local/bin/rpi-temp
$ cd /usr/local/bin
$ sudo chmod 755 rpi-temp
$ ./rpi-temp
44.79
```

ã“ã®çŠ¶æ…‹ãŒç¢ºèªã§ããŸã‚‰ã€`/etc/telegraf/telegraf.conf` ã®æœ€å¾Œã‚ãŸã‚Šã«ä»¥ä¸‹ã‚’ã„ã‚Œã‚‹ã€‚

```/etc/telegraf/telegraf.conf
[[inputs.exec]]
  commands = ["/usr/local/bin/rpi-temp"]
  name_override = "rpi_temp"
  data_format = "value"
  data_type = "float"
```

ã„ã‚ŒãŸã‚‰ã€Telegraf ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å†èµ·å‹•ã€‚pi4ã‚’å†èµ·å‹•ã—ãªãã¦ã‚‚ã„ã„ã™ã€‚

```cmd
$ systemctl restart telegraf.service
```

## Chronograf ã§ pi4 ã®æ¸©åº¦ã‚»ãƒ³ã‚µãƒ¼æƒ…å ±ãŒãã¦ã‚‹ã‹ ç¢ºèªã—ã¦ã¿ã‚‹ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44540/e073cfe8-791d-04f5-336c-654fcd187fc8.png)

ã™ã”ã†ã†ã€ã€MRTGã®è¨­å®šã‚ˆã‚Šè¶…ç°¡å˜ã€‚

# Windows10 ã§ Telegraf ä½¿ã†ã¨ãã®æ³¨æ„
ç°¡å˜ã«ç›£è¦–ã§ãã‚‹ã¯ãšãŒã€ãªãœã‹Windowsã ã‘ã†ã¾ãã„ã‹ãªã„ã€‚ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ãã£ã¦ã‚‹ã€‚

```text
2020-11-29T02:49:00Z W! [inputs.win_perf_counters] error while getting value for counter "\\Paging File(_Total)\\% Usage", will skip metric: ãƒ‡ãƒ¼ã‚¿ã¯æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
2020-11-29T02:49:10Z W! [inputs.win_perf_counters] error while getting value for counter "\\Paging File(_Total)\\% Usage", will skip metric: ãƒ‡ãƒ¼ã‚¿ã¯æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
```

VMä¸Šã®Windowsã¯ç›£è¦–ã§ãã‚‹ãƒ»ãƒ»ãƒ»ã€‚ã¨æ€ã£ã¦ãƒ­ã‚°ã‚’ã‚ˆãã¿ã‚‹ã¨ã€‚"Paging File" ã¨ã‚ã‚‹ã€‚ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ã„ãªã‹ã£ãŸï¼ˆåˆ‡ã£ã¦ã„ãŸï¼‰ã®ãŒåŽŸå› ã ã£ãŸã€‚


# ã¨ã‚Šã‚ãˆãšã¾ã¨ã‚

> ãƒ»[How To Install InfluxDB on CentOS 8 / RHEL 8](https://computingforgeeks.com/how-to-install-influxdb-on-rhel-8-centos-8/)
> ãƒ»[Telegrafã§ã‚µãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¦InfluxDBã«æ ¼ç´ã™ã‚‹](https://exlair.net/entry/2016/10/24/011133/)
> ãƒ»[ã€æ¯”è¼ƒã€‘Grafana vs. Chronograf - è¦–è¦šåŒ–ãƒ„ãƒ¼ãƒ«ã‚’æ¯”è¼ƒã—ã¦ã¿ãŸ -](https://qiita.com/MetricFire/items/0c188a17d7380056a042)
> ãƒ»[TICK stack ã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç’°å¢ƒã‚’æ§‹ç¯‰ (Telegraf + InfluxDB + Chronograf + Kapacitor)](https://tech.quickguard.jp/posts/tick-stack/)
> ãƒ»[ã€Iotè‡ªå®…ç’°å¢ƒä¸‹æº–å‚™ã€‘ã‚»ãƒ³ã‚·ãƒ³ã‚°ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ©ã‚ºãƒ‘ã‚¤ã§ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹InfluxDBã®è¨­å®š](https://bey.jp/?p=71986)
> ãƒ»[Spring boot metrics monitoring using TICK stack](https://aboullaite.me/spring-boot-metrics-monitoring-using-tick-stack/)
















