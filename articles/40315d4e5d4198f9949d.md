---
title: "ã„ã¾ã•ã‚‰ CentOS8 ã§ å†…å‘ãDNS(unbound)ã‚’å»ºã¦ã‚‹"
emoji: "ğŸ“"
type: "tech"
topics: centos8 unbound
published: true
---


è‡ªå®…ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã§ BIND å»ºã¦ã¦ã„ã‚‹ã‘ã©ãŠæ‰‹è»½ã«ã€Œå†…å‘ãDNS, ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒã€ã¨ã„ã†ã“ã¨ã§ unbound ã‚’å°å…¥ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šæ›´æ„ŸãŒå‡„ã„ã§ã™ã­ï½å®Ÿéš›ã¯è‡ªåˆ†ã®å‚™å¿˜éŒ²ã§ã™ï½—

# å†…å‘ãDNSï¼ˆDNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒã«unboundï¼‰ã‚’å»ºã¦ã‚‹
unbound ã ã‘ã§ãªãæŠ˜è§’ãªã®ã§ dig, nslookup ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚
è¨­å®šå†…å®¹ã§ã™ãŒè‰²ã€…ãªæ–¹ã®ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹ã¨ `unbound.conf` ã‚’ç›´æ¥å¤‰æ›´ã™ã‚‹æ–¹æ³•ãŒã¨ã‚‰ã‚Œã¦ã„ã¾ã™ãŒ [unbound.conf(5)](https://unbound.jp/unbound/unbound-conf/) ã‚’è¦‹ã‚‹ã¨ã€ "include:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™â€¦ï¼ˆä»¥ä¸‹ç•¥ï¼‰" ã¨ã®ã“ã¨ã§ã™ã®ã§å€‹åˆ¥è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ `/etc/unbound/conf.d` ã®ä¸‹ã«ä½œæˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã¯ unbound ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ `bind-utils` ã‚‚æŒ‡å®šã—ã¦ã„ã‚‹ã®ã¯ dig, nslookup ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€‚

```
# dnf install unbound bind-utils
```

unbound å…¨ä½“ã®è¨­å®š â€»unboundã‚µãƒ¼ãƒã‚’ `192.168.11.111` ã¨ã—ã¾ã™ã€‚

```/etc/unbound/conf.d/my_unbound.conf
server:
    interface: 0.0.0.0
    do-ip4: yes
    do-ip6: no
    do-udp: yes
    do-tcp: yes

    access-control: 0.0.0.0/0 refuse
    access-control: 127.0.0.0/8 allow
    access-control: 192.168.11.0/24 allow

    hide-version: yes
    hide-identity: yes

    logfile: "/var/log/unbound.log"
    use-syslog: no
    log-time-ascii: yes

forward-zone:
    name: "."
    forward-addr: 8.8.8.8
    forward-addr: 8.8.4.4
```

ã“ã®æ®µéšã§ `unbound-checkconf` ã‚’å®Ÿè¡Œã—å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã«èª¤ã‚ŠãŒç„¡ã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
ã‚µãƒ¼ãƒè¨¼æ˜æ›¸ãŒç„¡ã„ï¼ã¨ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ `unbound-control-setup` ã‚³ãƒãƒ³ãƒ‰ã§è¨¼æ˜æ›¸ã‚’ä½œæˆã—å†åº¦ `unbound-checkconf` ã‚’å®Ÿè¡Œã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

```
# unbound-checkconf
/etc/unbound/unbound_server.key: No such file or directory
[1585546626] unbound-checkconf[8958:0] fatal error: server-key-file: "/etc/unbound/unbound_server.key" does not exist
```

ã‚ã€‚log ã§ã™ãŒ `logfile: "/var/log/unbound.log"` ã¨ã—ã¦ã„ã‚‹ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãŠãã¾ã™ã€‚

```cmd
# touch /var/log/unbound.log
# chmod 666 /var/log/unbound.log
```

ã‚‚ã¡ã‚ã‚“ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ãŠã‹ãªã„ã¨ãƒ‘ãƒ³ã‚¯ã—ã¡ã‚ƒã†ã®ã§è¨­å®šã—ã¨ãã¾ã™ã€‚
ãƒ»[Unboundã§å†…å‘ãDNSã‚’å»ºã¦ã‚‹](https://jyn.jp/unbound-internal-dns/)


# ãƒ­ãƒ¼ã‚«ãƒ«ã®æ­£å¼•ã,é€†å¼•ãã®è¨­å®š
`/etc/unbound/conf.d` ã®ä¸‹ã«ä½œæˆã—ã¾ã™ã€‚ `unbound` ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

```my_hosts.conf
server:
    local-data: "nas. IN A 192.168.11.138"
    local-data-ptr: "192.168.11.138 nas."
```

resolv.conf ã® nameserver ã¯ `127.0.0.1` ã‚’æŒ‡å®šã™ã‚‹ã€‚

```/etc/resolv.conf
nameserver 127.0.0.1
```

DNSã‚’æŒ‡å®šã—ã¦ æ­£å¼•ã,é€†å¼•ã ãŒã§ãã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚

```
$ nslookup nas 192.168.11.111 â€»unboundã‚’è¨­å®šã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹
$ nslookup 192.168.11.138 192.168.11.111 â€»unboundã‚’è¨­å®šã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹
```

åŒä¸€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ä»–ã®ãƒã‚·ãƒ³ã‹ã‚‰ã‚‚åŒæ§˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ `nslookup` ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
time outã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€port:53 ãŒç©ºã„ã¦ãªã„ã®ã§ç©´ã‚ã‘ã™ã‚‹ã€‚

```cmd
# firewall-cmd --permanent --zone=public --add-service=dns
# firewall-cmd --reload
# firewall-cmd --list-all
```

ã‚ˆã—ã€ã‚ˆã•ã’ã«è¨­å®šã§ããŸï¼


# å‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸã‚µã‚¤ãƒˆæ§˜
ãƒ»[æ§‹ç¯‰äº‹ä¾‹ï¼šunboundã«ã‚ˆã‚‹DNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ](https://www.designet.co.jp/system/oss.php?category=dns&id=1&oss=unbound)
ãƒ»[Unboundã§å†…å‘ãDNSã‚’å»ºã¦ã‚‹](https://jyn.jp/unbound-internal-dns/)
ãƒ»[Unboundã‚’ä½¿ã£ã¦ã¿ã‚ˆã†](https://tech-lab.sios.jp/archives/12903)

