---
title: "ã„ã¾ã•ã‚‰ fluentd ã‚’ã¯ã˜ã‚ã¦ã¿ãŸLTSV ãªã«ãã‚Œç¾å‘³ã—"
emoji: "ğŸ“"
type: "tech"
topics: Fluentd Vagrant LTSV Apache nginx
published: true
---

# ã„ã¾ã•ã‚‰ fluentd ã¯ã˜ã‚ã¦ã¿ã‚‹ï¼’
æœ€çµ‚çš„ãªæ§‹æƒ³ã¯ã€ã€Œ[fluentd](http://www.fluentd.org/) + [Kibana](Kibana) + [elasticsearch](http://www.elasticsearch.org/) + [MongoDB](http://www.mongodb.org/)ã€ã®è½ã¨ã—ã©ã“ã‚ã ã‘ã©ã€[LTSV](http://ltsv.org/) ã£ã¦ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«å¼•ã£æ›ã‹ã£ãŸã®ã§èª¿æŸ»ã—ã¦ã¿ãŸã€‚

# LTSV ã£ã¦ï¼Ÿ
Labeled Tab-Separated Values ã¨ã„ã†ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜ã‚‰ã—ã„ã€‚ç™ºæƒ³ãã®ã‚‚ã®ã¯Goodã ã¨æ€ã„ã¾ã™ãŒæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾å¿œã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚ªãƒƒã‚µãƒ³ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ç¾¤ãŒç†è§£ã§ããªãã¦æ‹’å¦ã™ã‚‹ã«[300ç‚¹](https://www.google.co.jp/webhp?sourceid=chrome-instant&ion=1&espv=2&es_th=1&ie=UTF-8#q=%E3%82%AF%E3%82%A4%E3%82%BA%E3%83%80%E3%83%BC%E3%83%93%E3%83%BC)ï¼ˆå¤ã„ã­ï¼‰ã€‚
ã¨å†—è«‡ã£ã½ã‹ã£ãŸã§ã™ã­ï¼ˆæ±—ï¼‰ LTSV ã¯å¯èª­æ€§ãŒè½ã¡ã‚‹ã£ã¦æ„Ÿã˜ã¾ã—ãŸã€‚ãŸã äººé–“ã®ç›®ã‹ã‚‰è¦‹ã¦ã®å¯èª­æ€§ã§ã‚ã£ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰è¦‹ã‚Œã°æ›¸å¼ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã®ã§ä½™è¨ˆãªãƒ­ã‚¸ãƒƒã‚¯ãŒä¸è¦ã«ãªã‚‹ã®ã§è‰¯ã„å‚¾å‘ã§ã™ï¼ˆã“ã†ã„ã†ã¨ã“ã§bugãŒã§ãªã„ã®ã¯ã„ã„ã“ã¨ï¼‰ã€‚ã‚ã¨ç‰¹ã«æœ€è¿‘å‹•ãã®ãªã„ [ASF](Apache Software Foundation) ã‚ãŸã‚ŠãŒç©æ¥µçš„ã«å‹•ãã¹ãã ã¨æ€ã†ã®ã ã‘ã©ãƒ»ãƒ»ãƒ»ãã“ã¯ã¾ã‚ã„ã„ã‹ï½—

# Apache, nginx ã§ LTSV 
ã¡ã‚‡ã„ã¨ config ã‚’ã„ã˜ãã‚‹å¿…è¦ãŒã‚ã‚‹ãã‚‰ã„ã€‚

```/etc/httpd/conf/httpd.conf
LogFormat "domain:%V\thost:%h\tserver:%A\tident:%l\tuser:%u\ttime:%{%d/%b/%Y:%H:%M:%S %z}t\tmethod:%m\tpath:%U%q\tprotocol:%H\tstatus:%>s\tsize:%b\treferer:%{Referer}i\tagent:%{User-Agent}i\tresponse_time:%D\tcookie:%{cookie}i\tset_cookie:%{Set-Cookie}o" combined
```

> ãƒ»[Apacheãƒ­ã‚°ã‚’LTSVå½¢å¼ã«ã™ã‚‹éš›ã®ï¼’ã¤ã®è½ã¨ã—ç©´ã¨å¯¾å‡¦æ³•ï¼‹Apacheï¼†Fluentdã®LTSVè¨­å®šã‚µãƒ³ãƒ—ãƒ«](http://y-ken.hatenablog.com/entry/apache-tips-ltsv-access-log)
> ãƒ»[ã‚µã‚¤ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚°ãƒ©ãƒ•è¡¨ç¤ºã™ã‚‹æ–¹æ³• nginx â†’ LTSV â†’ Fluentd(td-agent) â†’ GrowthForecast](http://www.e-agency.co.jp/column/20130423.html)

## fluentd ã®è¨­å®š
```format ltsv``` ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã€‚
ãƒãƒã‚‹ã¨ã“ã¯ã€ /var/log/httpd/access_log ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ ```td-agent``` ãƒ¦ãƒ¼ã‚¶ã§å‚ç…§ã§ãã‚‹ã“ã¨ã€‚ã“ã“å¤§äº‹ï½—

```lang:td-agent.conf
<source>
  type tail
  path /var/log/httpd/access_log
  format ltsv
  time_key time
  time_format %d/%b/%Y:%H:%M:%S %z
  tag td.apache.access
  pos_file /var/log/td-agent/apache_access.pos
</source>
```

# æ¬¡ã¯
mongoDB ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚’å‹‰å¼·ã—ã¦ã¿ã‚‹ï¼ˆ[ãã®ï¼“](http://qiita.com/murachi1208/items/8dc03a77fdde97bb4b16)ï¼‰ã®äºˆå®šã§ã™ï½—


