---
title: "Raspberry Pi 4B で、SDカード→SSD(正確には USB-HDD)して"
emoji: "📝"
type: "tech"
topics: RaspberryPi pi4b ssd
published: true
---

前回の続き「[Raspberry Pi 初期設定まとめ](https://qiita.com/murachi1208/items/79706fce06a201231216)」 まだ画面はOFFってない(苦笑

# SDカードからUSB"HDD"、またもはまる
TOKYO2020実施できないコロナ渦。みなさんテレワークしてます？久しぶりに購入したPi4でVPNサーバ立ち上げてますが便利ですね。。とSDカードでの運用が不安でしたので、SSD(正確には USB"HDD")してみました。

とりあえず、毎回どこかではまる作業、約2ケ月悩んで解決したので。記事にしてみました。

# Pi4Bは、SDカード→簡単に USB"HDD" 化できます

まず、@eurogrve さんの記事
[Raspberry Pi4のUSB(HDD)起動設定](https://qiita.com/eurogrve/items/4802d18321cfbe72157b) で簡単に USB(HDD) 化できます。

が、私は…できなかった。以下、そんな人は参考にしてみてください。

# 結論が知りたい人
この記事の[下部みて](https://qiita.com/murachi1208/items/9a363e3aaf96ec1402b8)、まとめてあります。

# @eurogrve さんのやり方でSSD化できないパターン各種です（以下、NGパターン）
前提として @eurogrve さんの対応はしてください。
ここでは、SSD と SATA-USB変換ケーブルあるのを前提とします。

## NOOBS からOSインストールした？
NOOBS から「Raspbian」をインストールした、こいつはSSD化できない。
まさにこの画面から先に進まない。
という情報をどこかで見かけたんだけどソース元は不明。でもわたしはこれのせいで、１ケ月悩みとおしましたｗ

![IMG_5557.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44540/6195f77d-265d-e3a2-d518-506558f3eb35.png)


## SSDから起動しないパターン

こんな画面が表示される。
きっとファームウエアの更新？が正しくされてないだけと思う。いま(2020/8)以降このパターンはないはず。

![IMG_5557.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44540/6195f77d-265d-e3a2-d518-506558f3eb35.png)

## ダメージだとかlockとか起動しないパターン

画像キャプするのわすれた。
実際SSDから起動しているので「あれ？これ少し待てば立ち上がるのでは？」と思ってしまう。結局なんか起動シーケンスごちゃごちゃやっているが、立ち上がらない。
ダメージだとかlockとか表示され、1時間以上ループして（いやもっとか？）る。

## microSDの内容をコピーするのが異様に遅く起動しないパターン

体感ですが「SD Card Copier」コピーに20分以上掛かる、もうこの時点でNGと思ったほうがいい。SSDがデバイスとして認識しているが、なんかだめみたい（＝この状況が不明）。

なんかだめみたいで悔しいので syslogとかデバイス状況みても「SD Card Copier」のエラーがない・・が。SSDから起動すると「ダメージだとかlockとか、、」まあ起動してこない。

## ファームを最新にしてない？パターン、、起動しない。え？それおいしいの？

正確には、起動する。loginまでくる。loginできる。
いやでもデバイスが認識しない。へ？ `lsusb` でもデバイスがあるが `/dev/*` いないとか。。。ファームを最新にすると…くぇうぇｒｈｓｄｊｋふえう、ま、ようするに「いけてない」状態になる。

意外と（？）最新ファームは、devあれ？ないの？がある。ある。ので注意が必要。

## USB 3.0 ケーブルだが遅く起動しないパターン

amazonで "SATA-USB 3.0 変換ケーブル 2.5インチ SSD/HDD用 SATAケーブル 5Gbps" をかってみた。SSDは、CFDとかsamusun 、、なぜか起動しない。

遅いじゃなく、コンソールに”ダメージだとかlock、キー入力しろとか”２時間、みてみた。なんだろ…。

## USB 3.0 だめなの？起動してもたたないの？

Pi4には、USB 3.0 の口が２つある。ここに 3.0対応のUSBを指したら認識する………………ファームが上がると仕様が変更されるようです。deviceが認識されない。
※相性問題らしい

## 偽装 USB 3.0 製品

regulation がどうなっているか不明。ファームあげると USB 2でも認識しないとか、ある。たぶん最新ファームにUPしないのが幸せ。
`dev`にないとか`lsusb`認識しない。理由は不明。
ちなみに windows10ってここらへん、大らかに認識してくれる。

## そのケーブル壊れてません？
意外ですがケーブルが壊れていることがある。いわゆる断線とか。
中華製品が悪いといってないけど割合は多いかもしれない。
http://higehige4.blogspot.com/2017/06/raspberry-pihdd.html

むかしHUBが壊れたときあって、先輩が「こいう製品は壊れないんだよ！この禿！」っていってたのを思い出した。結局壊れていて先輩、会社からめっちゃ怒られてたなーー。

# 結論

① ファーム最新にしない。※これ重要
① 安いUSB 3.0 の製品、実はUSB 2.0だった。USB 2.0 の口にさすと認識する（USB2 の口にさす）で解決。
→ これ意外と多い、320円ぐらいの製品あるが USB 2.0でいけます
→ amazonの3rdで指摘するとUSB 3.0に対応してないの認識しているらしい
③ USB 2.0対応でも、指す物理的場所（上下）でも認識しないことがある。
→ pi4の相性？こういうの困るね
④ USB 2.0バスパワーの製品、相性がある。給電しないっていうもある。
→ 金額の問題じゃないみたい
⑤ なんとなく動作がOKだったら、全体構成を写メしとく。


## 結論の尻論
　1) SSDは、USB 2.0に接続する
　2)　「ファーム最新にしない」、USBは「物理的な接続位置
を変更しない」が正解
　　　→ 抜き差しするだけで認識してくれない謎…ｗ
　3) SATAケーブルは、USB2.0に接続すると安定する
　4) 動作.1週間安定化してたら、その状態のOSをバックアップする　
　5) 大規模アップデート(3,4日ごと）は、とりあえずしない
　*) もう相性ってあるよかなりツンデレさｍｍ

## 結論の尻論の結局

・個人的に pi4 での運用、気に入ってます。（ファンレス難しい）
・たかだか6000円ぐらい価格で遊べる。dokerもいれれる。
・ssdにすると安定性アップする。

# 最後に

@eurogrve さんに報告したら

> 手持ちのパーツでもNGとなるHDDケース、HDDがありました。

とｗ　早く知りたかったがお買い物も楽しかったし、こういう悩んでいる時間もおもろしい。

でも結局のとこ、pi4 が 3台手元にある…。2台は、録画サーバにしたりVPNにしたりおもちゃ箱にしているのでいいが。。。ま、深く考えないことにした。









