---
title: "CentOS7.3 ç’°å¢ƒ(Vagrant)ã« Mattermost ã„ã‚ŒãŸã®ã§ Huboté€£æºã—ã¦ã¿ã‚‹ã€€ãã®ï¼“"
emoji: "ğŸ“"
type: "tech"
topics: Vagrant Mattermost Hubot
published: true
---

# hubotã£ã¦
GitHubç¤¾ãŒé–‹ç™ºã—ãŸãƒãƒ£ãƒƒãƒˆ(bot)ã§ã™ã€‚é–‹ç™ºãƒ»å®Ÿè¡Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯ã€CoffeeScript ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ç°¡å˜ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ã®ãŒç›®ç‰ã§ã™ã­ã€‚ä½¿ç”¨ç”¨é€”ã¨ã—ã¦ã¯ã€Slackã«çµ„ã¿è¾¼ã‚“ã§ DevOps æ¥½ï½ã«ï½ãªã‚“ã¦ã„ã†ã®ãŒæµè¡Œã£ã¦ã‚‹ï¼ˆçµæ§‹å‰ã‹ã‚‰ã ã‘ã©ã­ï¼‰ã¨ã„ã†ä»£ç‰©ã§ã™ã€‚
Node.js ã§å‹•ãã®ã§å°å…¥ã™ã‚‹ã«ã‚‚ã‹ãªã‚Šæ•·å±…ãŒä½ã„ã£ã¦ã„ã†ã®ãŒäººæ°—ãŒã‚ã‚‹ã£ã½ã„ã€‚

> [GitHubç¤¾è¬¹è£½ï¼ boté–‹ç™ºãƒ»å®Ÿè¡Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ŒHubotã€](http://gihyo.jp/dev/serial/01/hubot)
> [ã€Slackã€‘15åˆ†ã§ä½œã‚‹çŒ«ãƒœãƒƒãƒˆ ï¼ˆHubot + äººå·¥çŸ¥èƒ½ãƒœãƒƒãƒˆAPIï¼‰](http://www.e-agency.co.jp/column/slackbot_ai.html)

# huboté€£æº
[terukizm](http://qiita.com/terukizm) ã•ã‚“ã® [Huboté€£æº](http://qiita.com/terukizm/items/4524249dd7f1298fdc06#hubot%E9%80%A3%E6%90%BA) è¨˜äº‹ãŒã¨ã¦ã‚‚åˆ†ã‹ã‚Šæ˜“ã„ã®ã§ãã¡ã‚‰ã®è¨˜äº‹ã«æ²¿ã£ã¦é€²ã‚ã¾ã—ãŸã€‚ãŸã  Mattermost ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè‹¥å¹²å¤ã„ã®ã§ãã“ã‚‰ã¸ã‚“ã‚’æœ€æ–°åŒ–ã—ã¦ã¿ã‚‹ã€‚ã‚ã¨ vagrantç‰ˆ[hubot-mattermost-vagrant](https://github.com/terukizm/hubot-mattermost-vagrant) ãŒã‚ã‚Šã¾ã™ãŒã¾ãšï¼‘ã¤ãšã¤æ‰‹ã§å®Ÿè¡Œã—å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ãã¨ã„ã†æ„å‘³ã§ã‚ã–ã‚ã–ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã¾ã™ï½—ã€‚

# vagrant ã§ç’°å¢ƒã‚’ä½œæˆ
ã“ã‚“ãªæ„Ÿã˜ã§ä½œæˆã—ã¾ã™ã€‚ipå›ºå®šã§ï½—

ãƒ»Hubotå´ã€€â€»Hubotã®å—ã‘å£ãƒãƒ¼ãƒˆã¯ã€18080 ã¨ã—ã¾ã™ã€‚

```
config.vm.define :cent73hubot do |cent73hubot|
  cent73hubot.vm.box = "bento/centos-7.3"
  cent73hubot.vm.network :private_network, ip: "192.168.11.226"
  cent73hubot.vm.provider "virtualbox" do |v|
    v.customize ["modifyvm", :id, "--memory", 512]
  end
end
```

ãƒ»Mattermostå´ã€€â€»ãƒ›ã‚¹ãƒˆå´ã«portforward ã—ã¦ã¾ã™

```
config.vm.define :cent73Mattermost do |cent73Mattermost|
  cent73Mattermost.vm.box = "bento/centos-7.3"
  cent73Mattermost.vm.network :private_network, ip: "192.168.11.224"
  cent73Mattermost.vm.provider "virtualbox" do |v|
    v.customize ["modifyvm", :id, "--memory", 512]
  end
  config.vm.network :forwarded_port, host: 19191,  guest: 80
end
```



# Hubotã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã“ã‚Œã“ã‚Œã€ã“ã®ç”»åƒãŒã¿ãŸã„ã®ã§ã™ã‚ˆï½—ã€‚

```text:
                     _____________________________  
 _____              /                             \ 
 \    \             |   Self-replication process   |
 |    |    _____    |          complete...         |
 |__\\|   /_____\   \     Good luck with that.    / 
   |//+  |[^_/\_]|   /----------------------------  
  |   | _|___@@__|__                                
  +===+/  ///     \_\                               
   | |_\ /// HUBOT/\\                             
   |___/\//      /  \\                            
         \      /   +---+                            
          \____/    |   |                            
           | //|    +===+                            
            \//      |xx|                            
```

## Node.js , nvm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
CentOS7 ã§ node.js ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ‰‹é †ã€‚windowsã¨ã‹ã¯è‹¥å¹²é•ã†ã‹ã‚‚ã—ã‚Œãªã„ã‹ã‚‰ãã“ã‚‰ã¸ã‚“ã¯ã€googleå…ˆç”Ÿã«èã„ã¦æ¬²ã—ã„ã€‚

```bash:
$ sudo yum install epel-release
$ sudo yum install nodejs npm
```

é–‹ç™ºã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash:
$ sudo npm install -g jsfmt
$ sudo npm install -g sails
$ sudo npm install -g node-dev
$ sudo npm install -g pm2
$ sudo npm install -g forever
$ sudo npm install -g yo generator-hubot
```

## Hubotã®åˆæœŸè¨­å®š
ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦åˆæœŸè¨­å®šã‚’è¡Œã†ã€‚

```bash
$ mkdir matter-bot && cd matter-bot
$ yo hubot --adapter mattermost --owner=user@example.com --name=matter-bot --description=sample
```

ã¨ã‚Šã‚ãˆãšã“ã‚Œã§çµ‚ã‚ã‚Šã€‚

# Mattermost ã®è¨­å®š
çµ±åˆæ©Ÿèƒ½ã§ã€Œå†…å‘ãã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯, å¤–å‘ãã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã€ã‚’è¨­å®šã™ã‚‹ã€‚
â‘  Outgoint WebHooks ã‹ã‚‰ â‡’ Hubotã§å‡¦ç† â‡’ Incoming WebHooks
â‘¡ Hubotã§å‡¦ç† â‡’ Incoming WebHooks
â€»æ¼¢å­—ã ã£ãŸã‚Šè‹±å­—ã ã£ãŸã‚Šæ··ã˜ã£ã¦ã‚‹ã‘ã©è¨€ã£ã¦ã‚‹æ„å‘³ã¯åŒã˜ï½—

![image.png](https://qiita-image-store.s3.amazonaws.com/0/44540/c7290119-7742-f423-741a-eda0fd42d395.png)

## Outgoing WebHooks ã®è¨­å®š
ã¨ã‚Šã‚ãˆãšãƒãƒ£ãƒãƒ«ã€ŒTown Squareã€ã«å¯¾ã—ã¦å†…å‘ãã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ã€‚
```MATTERMOST_INCOME_URL``` ã®ç’°å¢ƒå¤‰æ•°ã¨ãªã‚Šã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/44540/113b7b59-d628-9bd5-9751-e8f1e91b00e2.png)

```192.168.1.128:19191``` ã¨ãªã£ã¦ã„ã‚‹ã®ã¯ã€ãƒ›ã‚¹ãƒˆå´IPã« portforward ã— ãƒ›ã‚¹ãƒˆå´ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã§vagrantã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã—ã¦ã„ã‚‹ã ã‘ãªã®ã§ã€é©å®œã“ã“ã‚‰ã¸ã‚“ä¿®æ­£ã™ã‚‹ã¹ã—ã€‚


## Incoming WebHooks ã®è¨­å®š
ã€Œmatter-botã€ã®ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚ŠHubotãŒèµ·å‹•ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã€‚
```MATTERMOST_TOKEN``` ã®ç’°å¢ƒå¤‰æ•°ã¨ãªã‚Šã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.amazonaws.com/0/44540/80882c8a-4e55-3186-5cd3-397e28099c97.png)

# Hubotã‚’èµ·å‹•ã™ã‚‹å‰ã®ç’°å¢ƒè¨­å®š
ãã®å‰ã«ç’°å¢ƒè¨­å®šã‚’ã™ã‚‹ã€‚

```~/.bash_profile
export PORT=18080
export MATTERMOST_ENDPOINT=/hubot/incoming
export MATTERMOST_TOKEN=jxh3dhx8yfn17ygo4pjrgqgrxy
export MATTERMOST_INCOME_URL=http://192.168.11.224/hooks/bg54t5czcpyzuxjt9ssaozw9we
export MATTERMOST_HUBOT_USERNAME=matter-bot
```

## Hubotã®ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨­å®š
terukizm/[hubot-mattermost-vagrant](https://github.com/terukizm/hubot-mattermost-vagrant) ã•ã‚“ã® [sample.coffee](https://github.com/terukizm/hubot-mattermost-vagrant/tree/master/hubot/scripts) ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚

```bash:
$ cd ~/matter-bot/scripts/
$ wget https://github.com/terukizm/hubot-mattermost-vagrant/blob/master/hubot/scripts/sample.coffee
```


## Hubotã‚’èµ·å‹•ã™ã‚‹
ã¨ã‚Šã‚ãˆãšèµ·å‹•ã—ã¦ã¿ã‚‹ã€‚

```
[vagrant@localhost matter-bot]$ bin/hubot -a mattermost
npm WARN hubot-help@0.2.2 requires a peer of coffee-script@^1.12.6 but none was installed.
[Wed Aug 02 2017 14:37:02 GMT+0900 (JST)] WARNING Loading scripts from hubot-scripts.json is deprecated and will be removed in 3.0 (https://github.com/github/hubot-scripts/issues/1113) in favor of packages for each script.

Your hubot-scripts.json is empty, so you just need to remove it.
[Wed Aug 02 2017 14:37:02 GMT+0900 (JST)] ERROR hubot-heroku-keepalive included, but missing HUBOT_HEROKU_KEEPALIVE_URL. `heroku config:set HUBOT_HEROKU_KEEPALIVE_URL=$(heroku apps:info -s | grep web.url | cut -d= -f2)`
[Wed Aug 02 2017 14:37:02 GMT+0900 (JST)] INFO hubot-redis-brain: Using default redis on localhost:6379
```

# è©¦ã—ã¦ã¿ã‚‹

![image.png](https://qiita-image-store.s3.amazonaws.com/0/44540/c4cefef0-1f70-1afc-2955-88774928104b.png)

ã¸ãƒ¼ã€‚PONG! ã¨ PONG ãŒãƒ»ãƒ»ãƒ»ã€ä½•æ•…è¡¨ç¤ºã•ã‚Œã‚‹ã®ã‹ã¯ä¸æ˜ã ã‘ã©ã€ã¾ã‚æ¦‚ã­ok

# å‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸã‚µã‚¤ãƒˆæ§˜

ä»Šå›ç‰¹ã«ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸï¼ï¼

> [Slackã‚¯ãƒ­ãƒ¼ãƒ³ã®Mattermostã‚’ä½¿ã£ã¦ã¿ã‚‹ - å¤–éƒ¨é€£æºç·¨ -ï¼ˆWebHooksã€Hubotï¼‰](http://qiita.com/terukizm/items/4524249dd7f1298fdc06#1-incoming-webhooks)

ã†ã‚“ã†ã‚“

> [hubotã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †](http://bukiyouengineermemo.blog.jp/archives/16784137.html)
> [Gitã¨CIã¨ã‹ãƒãƒ£ãƒƒãƒˆã¨ã‹ã‚’ã‚ªãƒ³ãƒ—ãƒ¬ã§é‹ç”¨ã™ã‚‹è©±](https://www.slideshare.net/mdome/gitci-72986353)



