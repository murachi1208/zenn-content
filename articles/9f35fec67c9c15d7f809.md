---
title: "Vagrant + CentOS6.6 + GitLab Omnibus 7.8.4ï¼ˆã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–¹"
emoji: "ğŸ“"
type: "tech"
topics: Vagrant GitLab Windows CentOS6.x
published: true
---

# 20åˆ†ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã‚‹ç°¡å˜æ‰‹é †
ã»ã‚“ã¾ã„ã„æ™‚ä»£ã ã‚ã‚„ã€‚ä»Šå›ã¯ã€20åˆ†ã§ã§ãã‚‹ã‚ã‚„ãƒ¼ã€‚ï¼ˆ10åˆ†ã§ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸï¼‰

## Gitlabã£ã¦
GitHubã‚’ä½¿ç”¨ã—ãŸã„ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é–¢ä¿‚ã¨ã‹å¤§äººã®è«¸äº‹æƒ…ï¼ˆï¿¥ï¼‰ã§ä½¿ãˆãªã‹ã£ãŸã‚Šã™ã‚‹å ´åˆã€GitHubã‚¯ãƒ­ãƒ¼ãƒ³ã£ã¦ã„ã†ã®ãŒã‚ã‚Šã¾ã™ã€‚ãã®ä¸­ã§ã‚‚ä¸€æŠ¼ã—ãªã®ãŒã€ŒGitLabã€ã€‚Omnibusç‰ˆ ã‚’ä½¿ãˆã°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚‚ç°¡å˜ã ã—Vagrantã ã£ãŸã‚‰â€¦ãã®ã¾ã¾åˆæœŸé‹ç”¨ã§ã‚‚å•é¡Œãªã—ã€‚

## å‰ææ¡ä»¶
Vagrant ã®ç’°å¢ƒã‚’æ§‹ç¯‰æ¸ˆã¿ã¯å¿…é ˆã§ã‚ã‚‹ã“ã¨ã€‚vm ã¯ã€CentOS6.6 ã§æ§‹ç¯‰ã€‚ã‚ã¨åŸºæœ¬çš„ãªã¨ã“ã¯ä¸‹è¨˜ã‚’èª­ã‚€ã‚ˆã‚ã—ã€‚

> https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md#configuration

### Vagantfile 
Gitlab ç”¨ã«vmã‚’ç”¨æ„ã—ã¾ã™ã€‚private ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ã‚‹ã®ã§ãã“ã‚‰ã¸ã‚“ã¯é©å®œä¿®æ­£ã™ã‚‹ã“ã¨ã€‚
ãƒ¡ãƒ¢ãƒªãƒ¼ã¯ã€384MBã ã¨ãã¤ã„ã®ã§ã€ä½™è£•ãŒã‚ã‚Œã°æœ€ä½1024MBã‚’ã¨ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼ˆSSDç’°å¢ƒãªã‚‰swapç™ºç”Ÿã—ã¦ã‚‚æ°—ã«ãªã‚‰ãªã„ã‘ã©ã­ï¼‰


```lang:Vagantfile
config.vm.define :gitlab do |gitlab|
  gitlab.vm.hostname = "gitlab"
  gitlab.vm.network :private_network, ip: "192.168.11.108" 
  gitlab.vm.provider "virtualbox" do |v| 
    v.customize ["modifyvm", :id, "--memory", 1024] 
    v.name = "gitlab" 
  end

  gitlab.vm.provision "shell", inline: <<-EOT
    echo "ZONE=\"Asia/Tokyo\"" > /etc/sysconfig/clock
    echo "UTC=\"false\"" >> /etc/sysconfig/clock
    cp -p /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
  EOT
end
```

### Gitlab è¨­å®šã®å‰ã«
```gitlab-ctl reconfigure``` å®Ÿè¡Œæ™‚ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ« ```/etc/gitlab/gitlab.rb``` ã‚’äº‹å‰ã«ä½œæˆã—ã¦ãŠãã“ã¨ã€‚

```lang:command
$ sudo mkdir -p /etc/gitlab
$ sudo touch /etc/gitlab/gitlab.rb
$ sudo chmod 600 /etc/gitlab/gitlab.rb
```

### RPM ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨è¨­å®š
æœ€æ–°ç‰ˆã® Omnibus ã‚’ä½¿ã†è¨­å®šï¼ˆ2015/3/19ï¼‰ã€‚ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§å…¨éƒ¨å…¥ã‚Šã¾ã™ã€‚ç‰¹ã« Geilab ã¯ã€chefã§å¿…è¦ãªæƒ…å ±ã‚’è¨­å®šã¾ã§è¡Œã†ã®ã§è¦‹ã¦ã„ã¦æ°—æŒã¡ãŒã„ã„ã§ã™ã‚ã€‚

> [GitLab CE Downloads](https://about.gitlab.com/downloads/)

ä¸Šè¨˜ã®ãƒšãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã‚‹ã¨ãŠã‚Šã«å®Ÿè¡Œã™ã‚Œã°okã€‚

```lang:command
$ sudo yum install openssh-serve
$ sudo yum install postfix
$ sudo yum install cronie
$ sudo service postfix start
$ sudo chkconfig postfix on
$ sudo lokkit -s http -s ssh
```

```lang:command
$ curl -O https://downloads-packages.s3.amazonaws.com/centos-6.6/gitlab-7.8.4_omnibus-1.el6.x86_64.rpm
$ sudo rpm -i gitlab-7.8.4_omnibus-1.el6.x86_64.rpm
$ sudo gitlab-ctl reconfigure
```

### MTA ã®è¨­å®š
ä½œæˆã—ãŸ vm ã¯æ–°è¦ãƒ¦ãƒ¼ã‚¶ä½œæˆæ™‚ãªã©ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã™ã‚‹ã“ã¨ã ã‘ã¨ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚’å—ã‘å–ã‚‹ã“ã¨ã¯ãªã„ã“ã¨ã‚’å‰æã®ãƒãƒªã‚·ãƒ¼ã¨ã—ã¾ã™ã€‚ãã‚“ãªã‚ã‘ã§æœ€ä½é™ã®è¨­å®š(SMTP)ã ã‘è¨­å®šã‚’è¡Œã„ã¾ã™ï¼ˆé•·æœŸçš„ãªé‹ç”¨ã ã£ãŸã‚‰è‰²ã€…ã¨è€ƒæ…®ã—ãªã„ã¨ã ã‚ã‚ˆï¼‰ã€‚example.jp ã¯è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹ã“ã¨ã€‚

```lang:command
$ grep -v -e "^[ \t]*#" -e "^$" /etc/postfix/main.cf
myhostname = mx.example.jp
mydomain = example.jp
myorigin = $mydomain
$ sudo /etc/init.d/postfix restart
```

è‡ªåˆ†ã®æºå¸¯ã¨ã‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« ```mail``` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ãƒ†ã‚¹ãƒˆé€ä¿¡ã—ã¦ã¿ã‚‹ã€‚ã‚ã¨æ°—åˆã„å…¥ã‚Œã¦ postfix ã‚’è¨­å®šã™ã‚‹ãªã‚‰ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã•ã‚“ãŒæœ€é«˜ã«ã‚ã‹ã‚Šã‚„ã™ã„ã€‚
> http://kajuhome.com/postfix.shtml 

### /etc/gitlab/gitlab.rb ã®è¨­å®š
gitlab_email_from éƒ¨åˆ†ã¯ã€FQDN ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚Œã°ã„ã„ã§ã™ãŒã€Œç´°ã‹ã„ã“ã¨ã¯é¢å€’ã€ã¨ã„ã†ã®ã§ã‚ã‚Œã°å¼·å¼•ã«æ›¸ãæ›ãˆã¦ã—ã¾ã†ã®ã‚‚å‰ã€‚ã¡ãªã¿ã« Omnibusç‰ˆ ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã‚ã‚Œã°ç‰¹ã«æ›¸ãç›´ã™å¿…è¦ã¯ã‚ã¾ã‚Šãªã„ã¨æ€ã‚ã‚Œã‚‹ï¼ˆproxyä½¿ã£ã¦ã‚‹ã¨ã‹è‰²ã€…ã‚ã‚‹ã¨æ€ã†ã‘ã©ã­ï¼‰ã€‚

> https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab/attributes/default.rb

```/etc/gitlab/gitlab.rb
external_url "http://192.168.11.108"
unicorn["worker_processes"] = 1
postgresql["shared_buffers"] = "128MB"
postgresql["effective_cache_size"] = "32MB"
gitlab_rails['gitlab_email_from'] = "gitlab@example.jp"
```

### å†è¨­å®šã¨èµ·å‹•
```gitlab-ctl restart``` å®Ÿè¡Œã—ã¦ã‚‚ unicorn ã®èµ·å‹•ãŒé…ã„ã®ã§ã€1,2åˆ†çµŒéã—ã¦ã‹ã‚‰ã€```http://192.168.11.108``` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã€‚ã€Œæ„å¤–ã¨é…ã„ã€ãã‚Œã¯èªè­˜ã—ã¦ãŠãï½—

```
% sudo gitlab-ctl reconfigure
% sudo gitlab-ctl restart
```

### åˆæœŸãƒ¦ãƒ¼ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³
GitLab ã®åˆæœŸã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã„ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆçµ‚äº†å¾Œã«ã€ãƒ¦ãƒ¼ã‚¶ä½œæˆæ™‚ã«è¨­å®šã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ¡ãƒ¼ãƒ«ãŒé€šçŸ¥ã•ã‚Œã¦ã„ã‚Œã°okã€‚

```
Username: root 
Password: 5iveL!fe
```

### Gitlab ã®ä½¿ç”¨æ–¹æ³•
BIGLOBE ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° ç„¡æ–™ ã§å…¬é–‹ã—ã¦ã„ã‚‹ Gitlab ã®è³‡æ–™ãŒã¨ã¦ã‚‚ã‚ã‹ã‚Šã‚„ã™ã„ã€‚

> [BIGLOBE ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° é–‹ç™ºãŠå½¹ç«‹ã¡ãƒ‘ãƒƒã‚¯  GitLab åˆ©ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](http://cloudapplistore.biglobe.ne.jp/ca/help/devops_2_manual_GitLab.pdf)

# Omnibusç‰ˆã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ–¹æ³•
rpm ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å®šç¾©ã™ã‚‹ã ã‘ã€‚

```
$ curl -O https://downloads-packages.s3.amazonaws.com/centos-6.6/gitlab-7.8.4_omnibus-1.el6.x86_64.rpm
$ sudo rpm -Uvh gitlab-7.8.4_omnibus-1.el6.x86_64.rpm
$ sudo gitlab-ctl reconfigure
$ sudo gitlab-ctl restart
```

## ãã®ä»–

> [GitLab CE Omnibus ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - ãƒ€ãƒ¡å‡ºã— Blog](https://fumiyas.github.io/gitlab/install-omnibus.html)

