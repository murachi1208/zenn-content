---
title: "Node.js ã® mocky ã‚’ä½¿ç”¨ã— ã‚¹ã‚¿ãƒ–REST API ã‚’ä½œæˆã—ã¦ã¿ã‚‹ã€ãã®ï¼‘"
emoji: "ğŸ“"
type: "tech"
topics: Node.js mocky
published: true
---

# ã‚ˆãã‚ã‚‹ã“ã¨ï½—
ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã‚’ã—ã¦ã„ã‚‹ã¨å¤§å°ã«é–¢ä¿‚ãªãç”»é¢ä½œæˆæ‹…å½“ã€REST APIæ‹…å½“ã¨ä½œæ¥­åˆ†æ‹…ã‚’ã™ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã®æ™‚ã«å›°ã‚‹ã®ãŒç”»é¢ä½œæˆæ‹…å½“ã«ãªã£ãŸã¨ããªã‚“ã§ã™ã‚ˆã­ã€‚ä½•æ•…ã‹ã£ã¦ã„ã†ã¨ä¸¦åˆ—ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ‡ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒæ®†ã©ã§ã€ã¾ã‚ã€ŒREST APIæ‹…å½“è€…ã€ã¯ã€ä»•æ§˜ãŒæ±ºã¾ã‚‰ãªã„ã‹ã‚‰ä½œã‚Œãªã„ãƒ¼ã£ã¦é…ã‚Œã¦ã‚‚è¨€ã„è¨³ãŒã¤ãã€ã€ç”»é¢ä½œæˆæ‹…å½“ã¯ç€æ‰‹ã§ããªã„ãã™ã‚‹ã¨ã©ã‚“ã©ã‚“ç”»é¢ä½œæˆãŒé…ã‚Œã‚‹â€¦ã£ã¦ãŠã£ã¨ã€‚æ„šç—´ã£ã½ããªã£ã¦ãã¾ã—ãŸï¼ˆç¬‘ï¼‰

ã¨ã¾ã‚ã€ãã‚“ãªã‚ã‚ŠãŒã¡ãªã¨ãã«ã€ã©ã†ã™ã‚‹ã‹ã£ã¦ã„ã†ã¨APIè¨­è¨ˆæ›¸ã‚’è¦‹ãªãŒã‚‰ã€[ãƒ¢ãƒƒã‚¯ï¼ˆã‚¹ã‚¿ãƒ–ï¼‰](http://d.hatena.ne.jp/devbankh/201002)REST API ã‚’ä½œã‚‹ã‚ã‘ãªã‚“ã§ã™ã‚ˆã­php ã§ä½œã£ãŸã‚Šperl ã§ä½œã£ãŸã‚Šã¨ã€‚ãã—ã¦æ¯å›å°‘ã—é¢å€’ã ã£ãŸã‚Šã™ã‚‹ã‚ã‘ã§ã™ã‚ˆã€‚
ã§ã€ä»Šå›ã® mocky ã€ãªã‹ãªã‹ç°¡å˜ã«ã§ãã‚‹ã®ã§ã„ã„ã‹ã‚‚ã£ã¦æ€ã£ã¦ã¾ã™ï½—

# Node.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
EPELãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ä»Šå›ã€ç‰¹ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã“ã ã‚ã‚Šãªã„ã®ã§æœ€æ–°ç‰ˆã‚’ã„ã‚Œã¾ã™ã€‚

```
$ sudo yum install epel-release
$ sudo yum install nodejs npm
$ node -v
v0.10.33
```

# mocky ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[mocky ã‚’ä½¿ã£ã¦ã¡ã‚‡ã£ã¨è³¢ã„ã‚¹ã‚¿ãƒ–APIã‚µãƒ¼ãƒã‚’ä½œã‚‹](http://qiita.com/kz_takatsu/items/9736dac0f8d96c343fd6) ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’è¦‹ã¦ easymock ã¨ã‹ stubby ã‚’è¦‹ã¦ã¿ã¾ã—ãŸãŒã€è¨˜äº‹å…ƒã®æ–¹ã¨åŒã˜ã‚ˆã†ã«ã€Œã„ã¾ã„ã¡æ„Ÿã€ãŒåŒã˜ã§ã—ãŸï½—ã€‚ã§ã™ã®ã§ mocky ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

okv/mocky : https://github.com/okv/mocky

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è¶…ç°¡å˜ï½—

```
$ npm install -D mocky
```

# ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹
mocky ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹ Exsample ã‚’ã‚³ãƒ”ãƒšãªã©ã—ã¦ mock.js ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚ã¨ã¯ã€ç«‹ã¡ä¸Šã’ã‚‹ã ã‘ï½—

```
$ node mock.js
```

curl ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚get, post, put ãƒ¡ã‚½ãƒƒãƒ‰ã€ä»»æ„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¸¡ã—ã€ç°¡å˜ã«ã§ããã†ã§ã™ã­ã€‚

```
$ curl "http://127.0.0.1:4321/someurl1?a=b&c=d"
$ curl -F "a=b" -F "c=d" http://127.0.0.1:4321/someurl2
$ curl -F "a=b" -F "c=d" http://127.0.0.1:4321/someurl3 -X PUT
$ curl "http://127.0.0.1:4321/someurl4?a=99"
```

# ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦å‡¦ç†ã‚’å¤‰ãˆã‚‹
æ¥­å‹™APIã£ã½ãä½œã£ã¦ã¿ã¾ã™ã€‚ã‚ˆãã‚ã‚‹ã‚ã‚‹ã£ã¦ã„ã†å‡¦ç†ã‚’çµ„ã¿è¾¼ã‚“ã§ã¿ã¾ã—ãŸãŒã€å‡¦ç†ã‚’æ›¸ã‘ã°æ›¸ãã»ã©ã«å®Ÿã‚¢ãƒ—ãƒªã£ã½ããªã‚‹ã®ã§ã¾ã‚ã€è½ã¨ã—ã©ã“ã‚ãŒé›£ã—ã„ã§ã™ãŒç°¡å˜ã«ä½œã‚Œã‚‹ã®ãŒã„ã„ã§ã™ã‚ã€‚

```javascript:mocky_sample4.js
var mocky = require('mocky');
var fs = require('fs');
var url = require('url');
var querystring = require('querystring'); 

mocky.createServer([{
// Users
  url: /\/someurl5\?a=\d+&b=\d+/,
  method: 'get',
  res: function(req, res, callback) {
    var params = querystring.parse(url.parse(req.url).query);
    console.log(params.a);
    console.log(params.b);
    console.log(params.dd);
    console.log(params.xml);
    if (params.kj) {
      console.log(params.kj);
      var decode = new Buffer(params.kj, 'base64').toString();
      console.log(decode);
        callback(null, {
          status: 200,
          body: decode
        });
    }
    if (params.xml) {
      var tt = fs.readFileSync('./response_data/users.xml', 'utf8');
      tt = tt.replace(/co.jp/g, params.dd);
      console.log(tt);
        callback(null, {
          status: 200,
          body: tt
        });
    } else {
      var err = {
          code: 400,
          message: 'name and mail are required.'
        };
      callback(null, {
        status: 400,
        body: JSON.stringify(err)
      });
    }
  }
}
]).listen(4321);
```

```xml:response_data/users.xml
<?xml version="1.0" encoding="UTF-8" ?>
<venture>
  <company>
    <name>ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯æ ªå¼ä¼šç¤¾</name>
    <url>http://www.softbank.co.jp/</url>
  </company>

  <company>
    <name>æ¥½å¤©æ ªå¼ä¼šç¤¾</name>
    <url>http://www.rakuten.co.jp/info/</url>
  </company>
</venture>
```

base64å€¤ã‚’æ¸¡ã—ãŸã¨ã
curl "http://127.0.0.1:4321/someurl5?a=999&b=777&kj=44Gv44GS56a/44OP44Ky" --verbose

xmlã‚’è¿”å´ã—ãŸã„ã¨ã
curl "http://127.0.0.1:4321/someurl5?a=999&b=777&xml=on&dd=com" --verbose

ãƒ‘ãƒ©ãƒ¡ã‚¿ã‚¨ãƒ©ãƒ¼ã®ã¨ã
curl "http://127.0.0.1:4321/someurl5?a=999&b=777" --verbose

# æ„Ÿæƒ³
ä¸æº€ãŒã‚ã‚‹ã¨ã™ã‚‹ã¨ https ãŒä½¿ãˆãªã„ã“ã¨ï¼ˆã‚½ãƒ¼ã‚¹ã¿ã¦ã„ã‚‹ã¨è€ƒæ…®ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ä½¿ã„æ–¹ã‚’ã¾ãŸæ¨¡ç´¢ã—ã¦ã¿ã¾ã™ï¼‰ã€ï¼‘ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨˜è¿°ã™ã‚‹ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒå·¨å¤§åŒ–ã™ã‚‹ã®ã¯ä»•æ–¹ãªã„ã‹ãªï¼Ÿãã‚‰ã„ã§ã™ã€‚
ã¾ã‚ãªã«ã›ã‚ˆã€ç‰©ãŒJavaScript ãªã®ã§æ„å¤–ã¨ç°¡å˜ã«ä½œã‚Œã¾ã™ã­ã€‚Node.js ã¯ã€Windowsç‰ˆã§ã‚‚ã•ã£ãã‚Šå…¥ã‚‹ã—çµæ§‹ã€ã“ã‚Œã¯ã„ã„æ„Ÿã˜ã‹ã‚‚ã€‚

httpsã§å‹•ã‹ã›ã¦ã¿ãŸï½— 
[Node.js ã® mocky ã‚’ ã‚ªãƒ¬ã‚ªãƒ¬https ã§å‹•ã‹ã—ã¦ã¿ã‚‹ã€ãã®ï¼’](http://qiita.com/murachi1208/items/60d765d386aea431af3a)

# ãã®ä»–
> [node.jsã®requireã‚’ä½¿ã£ã¦ã¿ãŸï¼](http://akiyoshi220.blogspot.jp/2010/10/nodejsrequire.html)
> [Node.jsã§ã®Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼†ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼‹ãŠã¾ã‘](http://shoboshobopg.hatenablog.com/entry/2015/02/09/190510)
> [xml2js - node.js xmlè§£æãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](http://nodejs.osser.jp/node/node-xml-js/)




