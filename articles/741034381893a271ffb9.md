---
title: "PHPãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ŒLaravel5ã€ã®ç’°å¢ƒã‚’ Vagrant, CentOS 6.6, SCLã® PHP 5.4, Apache2.4, MariaDB 5.5 ã§ä½œã£ã¦ã¿ãŸã€ãã®ï¼‘"
emoji: "ğŸ“"
type: "tech"
topics: Vagrant CentOS6.x scl Laravel
published: true
---

## Laravel5, SCL ã®ç’°å¢ƒæ§‹ç¯‰
Laravel4ï¼ˆãƒ©ãƒ©ãƒ™ãƒ«ï¼‰ã®ç’°å¢ƒã‚’ä½œã£ãŸã‘ã©ã€ã™ã§ã« Laravel5 ãŒå‡ºã¦ã„ãŸã‚‚ã‚ã‚ŠæŠ˜è§’ãªã®ã§ã€[Software Collections](http://qiita.com/murachi1208/items/202bff84964188619f57) ã‹ã‚‰ PHP 5.4ä»¥ä¸Š, Apache, MariaDBã‚’å…¥ã‚Œç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

ãã—ã¦æ„å¤–ãªã¨ã“ã‚ã§ï¼“æ™‚é–“ã»ã©ã¯ã¾ã‚Šã¾ã—ãŸã€‚ã¾ã‚å‹‰å¼·ã«ã‚‚ãªã‚Šã‚ˆã‹ã£ãŸã‚“ã§ã™ã‘ã©ã€ä½•æ•…ã«æ¯å›ã¯ã¾ã‚‹ã‚“ã ã‚ã†ï¼Ÿã¨ï½—ã€‚

| ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|:-----------|:----------|
|Laravel     |5.0.16     | 
|PHP         |5.4.16     |
|Apache      |2.4.6      | 
|MariaDB     |5.5.40     | 

## Varagnt
ã“ã‚“ãªå®šç¾©ã§ã•ãã£ã¨ä½œã£ã¦ç«‹ã¡ä¸Šã’ã¨ãã¾ã™ã€‚

```
config.vm.define :laravel5 do |laravel5|
  laravel5.vm.network :private_network, ip: "192.168.11.213"
  laravel5.vm.provider "virtualbox" do |v|
    v.customize ["modifyvm", :id, "--memory", 384]
  end
end
```

## Software Collections (SCL) ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã¾ãšã¯ã˜ã‚ã«è¡Œã£ã¦ãŠãã“ã¨

```
# yum install centos-release-SCL
```

## PHP, PHP-FPM  ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
PHP ã¯ã€ã„ã¤ã‚‚ã¨ãŠã‚Šã€‚PHP-FPM (FastCGI Process Manager) ã‚’å…¥ã‚Œã‚‹ç†ç”±ã¯ã€SCL ã§ã¯ libphp5.so, libphp5-zts.so ãŒå…¥ã‚‰ãªã„ã‹ã‚‰ï¼ˆã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚Œã°å…¥ã‚Šã¾ã™ï¼‰ãªã€ãã‚“ãªç†ç”±ã§ã™ï¼ˆâ€»ã“ã“ã§ï¼“æ™‚é–“ãƒãƒãƒªã¾ã—ãŸï¼‰ã€‚
ã‚ã¨ mcrypt å…¥ã‚Œãªã„ã¨ Laravel ãŒæ€’ã‚‹ã®ã§ã„ã‚Œã¾ã™ãŒã€ä»Šå›ã¯æœ€ä½é™ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã ã‘å…¥ã‚Œã¦ã¾ã™ã‚“ã§å¿…è¦ãªã‚‰ã°é©å®œã„ã‚Œã‚‹ã“ã¨ã€‚

```
# yum install php54
# yum install -y https://www.softwarecollections.org/en/scls/rhscl/php54/epel-6-x86_64/download/rhscl-php54-epel-6-x86_64.noarch.rpm
# yum install -y php54-php-mbstring php54-php-fpm php54-php-pdo php54-php-mysqlnd
# yum install -y https://www.softwarecollections.org/en/scls/remi/php54more/epel-6-x86_64/download/remi-php54more-epel-6-x86_64.noarch.rpm
# yum install -y php54-php-mcrypt
```

### ãƒ­ã‚°ã‚¤ãƒ³/reboot æ™‚ã«php54 ã‚’æœ‰åŠ¹åŒ–
SCL ã§ã‚¤ãƒ³ã‚¹ã‚³ã™ã‚‹ã¨ /opt/rh ä»¥ä¸‹ã«é…ç½®ã•ã‚Œã€ã‹ã¤ scl ã‚³ãƒãƒ³ãƒ‰ã§ã”ã«ã‚‡ã”ã«ã‚‡ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ãƒ­ã‚°ã‚¤ãƒ³/reboot æ™‚ã«php54 ã‚’æœ‰åŠ¹åŒ–ã—ã¨ãã¾ã™ã€‚
/etc/profile.d/enablephp54.sh ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—å†…å®¹ã¯ä¸‹è¨˜ã‚’ã“ã´ãºã—ã¾ã™ã€‚

```text:/etc/profile.d/enablephp54.sh
#!/bin/bash
source /opt/rh/php54/enable
export X_SCLS="php54" 
```

> [https://access.redhat.com/solutions/527703]

ã“ã‚Œã§ ```php -v``` ã‚³ãƒãƒ³ãƒ‰ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### PHP-FPM ã®èµ·å‹•è¨­å®š
è¨­å®šã™ã‚‹ã¨ã“ã¯å¤šå°‘ã‚ã‚‹ã‘ã©ã€ã¨ã‚Šã‚ãˆãšãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç«‹ã¡ä¸Šã’ã¦ãŠãã¾ã™ã€‚
ã¡ãªã¿ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ ```127.0.0.1:9000``` ã§ã‚µãƒ¼ãƒ“ã‚¹ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

```
# service php54-php-fpm start
# chkconfig php54-php-fpm on
# chkconfig php54-php-fpm --list
```

## Apache ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã“ã¡ã‚‰ã‚‚ã•ãã£ã¨ã„ã¤ã‚‚ã®ã¨ãŠã‚Šã€ãªæ„Ÿã˜ã§ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã¾ã§ã‚„ã£ã¨ãã¾ã™ã€‚
å¿µã®ãŸã‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ç¢ºèªã—ã¨ãã¨ã€ã‚ˆã‚Šgoodã™ã­ã€‚

```
# sudo yum install httpd24
# service httpd24-httpd start
# /opt/rh/httpd24/root/usr/sbin/httpd -version
# chkconfig httpd24-httpd on
# chkconfig httpd24-httpd --list
```

## ã¤ã„ã§ã« MariaDB(MySql)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»Šå›ã€ç™»å ´ãªã„ã‘ã©ã¤ã„ã§ã«ï½—

```
# yum install mariadb55 mariadb55-server
# service mariadb55-mysqld start
# chkconfig mariadb55-mysqld on
```

/etc/profile.d/enablemariadb55.sh ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—å†…å®¹ã¯ä¸‹è¨˜ã‚’ã“ã´ãºã—ã¾ã™ã€‚

```text:/etc/profile.d/enablemariadb55.sh
#!/bin/bash
source /opt/rh/mariadb55/enable
```

### Composerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Composer ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½¿ã†ã®ã§ã€ã¾ãšã“ã‚Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã“ã‹ã‚‰åˆã‚ã¾ã™ã€‚

```
# curl -sS https://getcomposer.org/installer | php
# mv composer.phar /usr/local/bin/composer
```

ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚```.bashrc``` ã«è¿½åŠ ã—ã¦ãŠãã¨ã„ã„ã“ã¨ã‚ã‚Šã¾ã™ã­ã€‚

```
export PATH=$PATH:/usr/local/bin
```

### laravel5 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆï¼‰
æœ€æ–°ç‰ˆï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã—ãªã„ã¨å¸¸ã«æœ€æ–°ã‚’ã‚‚ã£ã¦ãã‚‹ï¼‰ã®laravel5 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã¨èµ·å‹•ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã¿ã¾ã™ã€‚
â€»åˆå›ã¯ã€è‰²ã€…ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€ãŸã‚éå¸¸ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚

```
$ composer create-project laravel/laravel hogehoge --prefer-dist
$ cd hogehoge
$ php artisan serve --host="0.0.0.0" --port="9090"
```

![ç„¡é¡Œ.png](https://qiita-image-store.s3.amazonaws.com/0/44540/0883afc7-5c69-f81c-011c-59386db0523b.png)

```http://192.168.11.213:9090``` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ä¸Šè¨˜ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ok

### Apache ã§ laravel ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‹•ã‹ã™å‰ã«ç¢ºèªã—ã¦ãŠãã“ã¨
Apache -> FirstCGI çµŒç”±ã§ php ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã¾ãšç¢ºèªã—ã¦ãŠãã“ã¨ã€‚
ã„ã‚ã‚†ã‚‹ phpinfo ã®æƒ…å ±ã‚’å‰ã‚‚ã£ã¦ç¢ºèªã—ã¦ãŠãã“ã¨ãŒé‡è¦ã€é‡è¦ã§ã™ï¼ˆï¼’åº¦ã„ã£ãŸï¼‰ã€‚

ãƒ†ã‚¹ãƒˆç”¨ã«é©å½“ã« conf ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šï¼ˆä¸‹è¨˜ã‚’å‚ç…§ï¼‰ã¾ã™ã€‚

```text:/opt/rh/httpd24/root/etc/httpd/conf.d/testphp.conf
Listen 8888
<VirtualHost 192.168.11.213:8888>
    DocumentRoot /opt/rh/httpd24/root/var/www/html2
    ServerName laravel5-test
    <LocationMatch "^/.*\.php$">
        ProxyPass fcgi://127.0.0.1:9000/opt/rh/httpd24/root/var/www/html2
    </LocationMatch>
    <Directory "/opt/rh/httpd24/root/var/www/html2/">
      Require all granted
    </Directory>
</VirtualHost>
```

phpã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã—ã¦ãŠãã¾ã™ã€‚

```
# mkdir /opt/rh/httpd24/root/var/www/html2
# echo "<?php phpinfo(); ?>" > /opt/rh/httpd24/root/var/www/html2/phpinfo.php
```

Apache. php-fpm ã‚’å†èµ·å‹•ã—ãŸã‚‰ ```http://192.168.11.213:8888/phpinfo.php``` ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ä¸‹è¨˜ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°okã€‚

![php.png](https://qiita-image-store.s3.amazonaws.com/0/44540/5eac7dfd-e450-ccb5-2006-10d1ce3f6cd1.png)

## Apache ã§ laravel ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‹•ã‹ã™
scl ã§ã‚¤ãƒ³ã‚¹ã‚³ã—ãŸ apache ã® DocumentRoot ã¯ã€```/opt/rh/httpd24/root/var/www/``` ãªã®ã§ã¨ã‚Šã‚ãˆãšãŠä½œæ³•ã«å¾“ã£ã¦ãã®ä¸‹ã« Laravel ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ ä½œã£ã¦ã¿ã‚‹ï¼ˆã©ã“ã§ã‚‚ã„ã„ã‚“ã ã‘ã©ã­ï½—ï¼‰ã€‚

ã¾ãšã¯ã€Laravel ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```
# cd /opt/rh/httpd24/root/var/www/
# composer create-project laravel/laravel /opt/rh/httpd24/root/var/www/laravel5 --prefer-dist
```

symfony/event-dispatcher ã§Github ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’èã„ã¦ããŸã®ã§ç´ ç›´ã«å…¥åŠ›ã€‚

```
  - Installing symfony/event-dispatcher (v2.6.4)

A token will be created and stored in "/root/.composer/auth.json", your password will never be stored
To revoke access to this token you can visit https://github.com/settings/applications
Username: 
Password: 
```
```/opt/rh/httpd24/root/etc/httpd/conf.d``` ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã•ãã£ã¨ä½œã‚Šã€httpd ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

```text:/opt/rh/httpd24/root/etc/httpd/conf.d/laravel5.conf
Listen 9999

<VirtualHost 192.168.11.213:9999>
    ServerName laravel5
    DocumentRoot /opt/rh/httpd24/root/var/www/laravel5/public
    DirectoryIndex index.html index.php
    <LocationMatch "^/.*\.php$">
        ProxyPass fcgi://127.0.0.1:9000/opt/rh/httpd24/root/var/www/laravel5/public
    </LocationMatch>
    <Directory "/opt/rh/httpd24/root/var/www/laravel5/">
      Require all granted
    </Directory>
</VirtualHost>
```

Apache 2.2 ã® conf ãã®ã¾ã¾ä½¿ãˆã‚‹ã¨æ€ã£ãŸã‚‰ 2.4 ã‹ã‚‰å®šç¾©ãŒã ã„ã¶å¤‰æ›´ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ç‰¹ã« NameVirtualHost ã®æŒ‡å®šã‚’ã—ãªãã¦ã‚‚ã‚ˆããªã£ãŸã‚Šç´°ã€…ã—ãŸã¨ã“ã‚ãŒã€‚ã€‚ã€‚

httpd ã‚’å†èµ·å‹•ã—ã¦â€¦ã€‚```http://192.168.11.213:9999/``` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚okã§ã™ã‚ˆã­ï½—

## å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã‚µã‚¤ãƒˆæ§˜

> [apache ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«/è¨­å®š ãƒ¡ãƒ¢](http://hideaki-momose.blogspot.jp/2014/04/apache_9.html)
> [CentOS6.4ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸApacheã‚’è¨­å®šã™ã‚‹ã€‚](http://alfa.hatenablog.jp/entry/2013/07/03/222507)
> [PHP5.5.5,PHP-FPMã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †(Apache, Mysql)](http://time-complexity.blogspot.jp/2013/11/php-fpm-with-apache.html)


