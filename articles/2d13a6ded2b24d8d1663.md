---
title: "ã„ã¾ã•ã‚‰ CentOS7.3 ã« AIDE(ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“æ¤œçŸ¥ãƒ„ãƒ¼ãƒ«)"
emoji: "ğŸ“"
type: "tech"
topics: CentOS Vagarant AIDE
published: true
---

# AIDE(Advanced Intrusion Detection Environment) ã£ã¦
ä»•äº‹ãŒå¿™ã—ããªã„ã®ã§è¶£å‘³ã‚’å…¼ã­ãŸã€ã„ã¾ã•ã‚‰ã‚·ãƒªãƒ¼ã‚ºï½—ã€‚
ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã® [AIDE](http://aide.sourceforge.net/)ï¼ˆAdvanced Intrusion Detection Environmentï¼‰ã¯ã€ã„ã‚ã‚†ã‚‹ãƒ›ã‚¹ãƒˆå‹ï¼ˆã‚µãƒ¼ãƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ç³»ï¼‰ã®ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã€ä¸»ã«ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæ”¹ã–ã‚“ã•ã‚ŒãŸã‹ã€ã©ã†ã‹ã‚’åˆ¤å®šï¼ˆæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼‰ã™ã‚‹ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ç›£è¦–ã™ã‚‹ã¨ã„ã£ã¦ã‚‚å¸¸é§å‹ã§ãªããƒãƒƒãƒå‹ãªã®ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ”¹ã–ã‚“ã•ã‚ŒãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§cronã§å®šæœŸçš„ã«å®Ÿæ–½ã—çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚‹ãªã©ã—ã¦ï¼ˆä»Šæ™‚ã ã¨Slackã«é€šçŸ¥ã‹ãªï¼‰ã‚µãƒ¼ãƒã®çŠ¶æ…‹ã‚’æŠŠæ¡ã™ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã­ã€‚

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã‚ã£ã¡ã‚ƒç°¡å˜ã§ã™ï½—ã€‚

```text
$ sudo yum install aide
```

## æ¤œçŸ¥å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨éæ¤œçŸ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š
```/etc/aide.conf``` ã«æ¤œçŸ¥ãƒ«ãƒ¼ãƒ«ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã¨ã‚Šã‚ãˆãšä¸‹è¨˜ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯æ¤œçŸ¥ã—ã¦æ¬²ã—ããªã„ã®ã§è¿½åŠ ã—ã¾ã™ã€‚â€» ```!``` ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆã‚’æŒ‡å®šã™ã‚‹ã¨éå¯¾è±¡ã«ã«ãªã‚Šã¾ã™ã€‚

```text:/etc/aide.conf
!/tmp
!/proc
```

## AIDEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
ã¾ãšåˆæœŸåŒ–ã€ã“ã‚Œå¤§åˆ‡ã‚ã‚‹ã­ã€‚

```text:bash
$ sudo aide --init
AIDE, version 0.15.1
### AIDE database at /var/lib/aide/aide.db.new.gz initialized.
```

## AIDEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
AIDEã®ä»•çµ„ã¿ä¸Šã€```å‰å›ã®ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯çµæœ``` ã¨ ```ä»Šå›ã®ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯çµæœ``` ã‚’æ¯”è¼ƒã™ã‚‹ãŸã‚ä¸Šè¨˜ã§åˆæœŸåŒ–å®Ÿæ–½ã—ãŸçµæœãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚

ã“ã‚“ãªå®šç¾©ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€‚

```text:/etc/aide.conf
@@define DBDIR /var/lib/aide
database=file:@@{DBDIR}/aide.db.gz
database_out=file:@@{DBDIR}/aide.db.new.gz
```

ã‚³ãƒ”ãƒ¼ã—ãªã„ã¨æ€’ã‚‰ã‚Œã‚‹ã§ã™ã‚ˆï½—ï½—

```text:bash
$ sudo aide -C
Couldn't open file /var/lib/aide/aide.db.gz for reading
```

ãã‚“ãªè¨³ã§åˆæœŸåŒ–ã§ä½œæˆã•ã‚ŒãŸAIDEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```text:bash
$ sudo mv -f /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz
```

## ã¨ã‚Šã‚ãˆãšãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã‚‹
ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚çµæœã¯ã€```/var/log/aide/aide.log``` ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã•ã‚Œã‚‹ã®ã§å®Ÿè¡ŒãŒçµ‚ã‚ã£ãŸã‚‰ã¿ã¦ã¿ã‚‹ã¨ã‚ˆã„ã€‚

```text:bash
$ sudo aide -C
```

## AIDEã‚’å®Ÿè¡Œã—ã‹ã¤AIDEãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ›´æ–°ã™ã‚‹ã¨ã‹ã‚·ã‚§ãƒ«
ã¾ã‚æ™®é€šä½œã‚Šã¾ã™ã‚ˆã­ã‚·ã‚§ãƒ«ã€‚ãã—ã¦cronã§å®šæœŸçš„ã«å®Ÿè¡Œã—ã¾ã™ã‚ˆã­ã€‚
ç§ã®ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã®ãƒ«ãƒ¼ãƒ«ã§ã¯ã€è‹±å­—ã ã‘ã®subjectã ã¨å¼¾ã‹ã‚Œã¦ã—ã¾ã†ã®ã§æ¼¢å­—ã«ã—ã¦ã„ã¾ã™ã€‚

```bash:aide.sh
#!/bin/bash

OK_MAIL="AIDEãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“ãƒã‚§ãƒƒã‚¯OK"
NG_MAIL="AIDEãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“ãƒã‚§ãƒƒã‚¯NGå•é¡Œã‚ã‚Š"

MAILTO=vagrant
LOGFILE=/var/log/aide/aide.log
AIDEDIR=/var/lib/aide
/usr/sbin/aide -u > $LOGFILE
/usr/bin/cp $AIDEDIR/aide.db.new.gz $AIDEDIR/aide.db.gz
x=$(/usr/bin/grep "Looks okay" $LOGFILE | /usr/bin/wc -l)

if [ $x -eq 1 ]
then
  echo "OK" | /usr/bin/iconv -f utf-8 -t iso-2022-jp | /bin/mail -s `echo $OK_MAIL | /usr/bin/nkf -j | /usr/bin/nkf -M` $MAILTO
else
  /usr/bin/cat $LOGFILE | /usr/bin/nkf -j | /bin/mail -s `echo $NG_MAIL | /usr/bin/nkf -j | /usr/bin/nkf -M` $MAILTO
fi
```

# ä½¿ã£ãŸæ„Ÿæƒ³
ã“ã‚“ãªæ–½ç­–ã—ã¦ã‚‚å‡„è…•ã®ãƒãƒƒã‚«ãƒ¼ã«ã—ãŸã‚‰ã€Œã¸ã£ã€ã£ã¦ãªã‚‚ã‚“ã§ã™ãŒã€ã¾ã‚ã‚„ã‚‰ãªã„ã‚ˆã‚Šã¯ãƒã‚·ã£ã¦æ„Ÿã˜ã§ã™ã‹ã­ã€‚ã‚ã¨æ”¹ã–ã‚“ã§ã¯ãªã„ã‘ã©ä¸ç”¨æ„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ã¾ã£ãŸå ´åˆã€ã“ã®AIDEã§ç›£è¦–ã§ãã‚‹ã®ã§ãã†ã„ã†ç‚¹ã§ã¯ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

# å‚è€ƒã«ã•ã›ã¦é ‚ã„ãŸã‚µã‚¤ãƒˆæ§˜

> [CentOS ã«ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’å°å…¥ã™ã‚‹ã€AIDEã€‘](http://hacknote.jp/archives/18027/)
> [ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã® IDS ã§ã‚ã‚‹ AIDE ã‚’ CentOS ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹](https://www.websec-room.com/2013/11/09/999)
> [ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIDEï¼‰ã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹](http://techblog.clara.jp/2015/04/aide_install_and_setting/)







