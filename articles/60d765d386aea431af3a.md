---
title: "Node.js ã® mocky ã‚’ ã‚ªãƒ¬ã‚ªãƒ¬https ã§å‹•ã‹ã—ã¦ã¿ã‚‹ã€ãã®ï¼’"
emoji: "ğŸ“"
type: "tech"
topics: Node.js
published: true
---

# ã‚ªãƒ¬ã‚ªãƒ¬https
[Node.js ã® mocky ã‚’ä½¿ç”¨ã— ã‚¹ã‚¿ãƒ–REST API ã‚’ä½œæˆã—ã¦ã¿ã‚‹ã€ãã®ï¼‘](http://qiita.com/murachi1208/items/c33033981f6cc34f4310) ã§ã€https å¯¾å¿œã§ããªã„ã‹ãªã¨èª¿ã¹ãŸã‚‰ã•ã£ãã‚Šã§ããŸã®ã§ãã®ãƒ¡ãƒ¢

ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã¯ã€ã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸ã‚’ä½œã‚‹ã®ã§ãã‚“ãªã‚ã‘ã§ã€ã‚ªãƒ¬ã‚ªãƒ¬httpsã¤ãƒ¼ã“ã¨

# ã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸ä½œæˆæ–¹æ³•
ä½œã‚Šæ–¹ã¯ç°¡å˜ã€è³ªå•ã•ã‚Œã‚‹ã‘ã©ã¾ã‚é©å½“ã«ç­”ãˆã¦å•é¡Œãªã„ã§ã™ã€‚ã‚ã¨æœ‰åŠ¹æœŸé™ã¯ã€10å¹´ã§ä½œæˆã—ã¦ã¾ã™ã€‚
ã¡ãªã¿ã« openssl ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã“ã¨ã€‚

```
$ openssl genrsa -out key.pem 1024
$ openssl req -new -key key.pem -out csr.pem
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:JP
State or Province Name (full name) []:Tokyo
Locality Name (eg, city) [Default City]:Kanda
Organization Name (eg, company) [Default Company Ltd]:hoge
Organizational Unit Name (eg, section) []:
Common Name (eg, your name or your server's hostname) []:
Email Address []:ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
```

æœ‰åŠ¹æœŸé™ã‚’10å¹´ã§ä½œæˆã™ã‚‹ã€‚

```
$ openssl x509 -req -in csr.pem -signkey key.pem -out cert.pem
```

# ä½œæˆã—ãŸè¨¼æ˜æ›¸ã‚’ mocky ã«ã‚³ãƒ”ãƒ¼
ä½œæˆã—ãŸ cert.pem, csr.pem ã‚’ ```node_modules/mocky/lib``` ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```
$ cd ./node_modules/mocky/lib
$ cp ../../../*.pem .
```

ã‚ªãƒªã‚¸ãƒŠãƒ«ã® mocky.js ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãŠãã¾ã™(httpã§ä½¿ã†ã¨ãã®ãŸã‚ã«ï¼‰ã€‚ãã—ã¦ã¡ã‚‡ã³ã£ã¨è¿½åŠ ã™ã‚‹ã®ã¨ä¿®æ­£ã—ã¾ã™ã€‚

```
$ cd ./node_modules/mocky/lib
$ cp mocky.js mocky.js.old
$ diff mocky.js mocky.js.old
5,11d4
< var fs = require('fs');
< 
< //
< var options = { 
<     key: fs.readFileSync('key.pem'),
<     cert: fs.readFileSync('cert.pem')
< };
20c13
<               srvType = params.srvType || 'https',
---
>               srvType = params.srvType || 'http',
52c45
<       return require(srvType).createServer(options, function(req, res) {
---
>       return require(srvType).createServer(function(req, res) {
```

# mocky_sample4.js ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹
[Node.js ã® mocky ã‚’ä½¿ç”¨ã— ã‚¹ã‚¿ãƒ–REST API ã‚’ä½œæˆã—ã¦ã¿ã‚‹ã€ãã®ï¼‘](http://qiita.com/murachi1208/items/c33033981f6cc34f4310) ã§ä½œæˆã—ãŸ ```mocky_sample4.js``` ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

```
$ node mocky_sample4.js
```

ç‰¹ã«ã‚¨ãƒ©ãƒ¼ã‚‚ã§ãªã„ã§ã™ã­ï½—

curl ã§ã€ã‚ªãƒ¬ã‚ªãƒ¬httpsï¼ˆç„¡è¦–ã™ã‚‹ã‚“ã ã‘ã©ã­ï¼‰ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚

```
$  curl "https://127.0.0.1:4321/someurl4?a=999&b=777&kj=44Gv44GS56a/44OP44Ky" -k --verbose
```

okã†ã¾ãã„ã£ãŸã€‚

# å‚è€ƒã‚µã‚¤ãƒˆ

> [Node, iOS, Android, HTML5, JavaScriptã®è©±é¡Œã€‚ã¨ãã©ãMacã‚„Linuxã€‚](http://codedehitokoto.blogspot.jp/2012/02/nodejshttps.html)
> [ã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸ã‚’opensslã§ä½œã‚‹ï¼ˆè©³ç´°ç‰ˆï¼‰](http://d.hatena.ne.jp/ozuma/20130511/1368284304)

